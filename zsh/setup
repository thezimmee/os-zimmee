#!/usr/bin/env bash

reinstall_ohmyzsh=false
ohmyzsh_defaults_filename=.zshrc-oh-my-zsh-defaults

# [[[ Gather user input

if [ -z $OSZ_ROOT ]; then
	read -e -p "[??] Where is OS Zimmee installed? " -i "$HOME/Projects/os-zimmee" reply
	OSZ_ROOT=$reply
fi

if [ ! -d "$HOME/.oh-my-zsh"  ]; then
	reinstall_ohmyzsh=true
else
	read -p "Reinstall oh-my-zsh? (Yes|no) " reply
	if [[ $reply =~ ^(yes|y)$ ]]; then
		reinstall_ohmyzsh=true
	fi
fi

# ]]]

# [[[ Reinstall oh-my-zsh?
if [ $reinstall_ohmyzsh = true ]; then
	rm -rf "$HOME/.oh-my-zsh"
	# Download oh-my-zsh.
	curl -s https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh | source /dev/stdin
	# Replace .zshrc and save oh-my-zsh's .zshrc as .zshrc-oh-my-zsh.
	mv -f "$HOME/.zshrc" "$OSZ_ROOT/zsh/$ohmyzsh_defaults_filename"
fi
# ]]]

# [[[ Symlink .zshrc.
rm -rf "$HOME/.zshrc"
ln -s "$OSZ_ROOT/zsh/.zshrc" "$HOME/.zshrc"
# ]]]

# [[[ Set up zsh as default shell.
if [ $SHELL != /bin/zsh ]; then
	chsh -s /bin/zsh
fi
echo '[ok] Success! ZSH is set up.'
# ]]]

# ## Symlink other *.link files.
# @TODO: Move this to a `dotfiles` directory.
# for dotfile in $(find ${OSZ_ROOT}/zsh/ -name '*.link*'); do
# 	dest="$HOME/.$(basename "${dotfile%.link*}")"
# 	echo "Setting up $dotfile..."
# 	if [[ $REFRESH = true ]]; then
# 		ln -sf "$dotfile" "$dest"
# 	else
# 		ln -s "$dotfile" "$dest" || echo "Skipped $dotfile."
# 	fi
# done
